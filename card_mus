type: custom:button-card
name: Power Control
show_icon: false
styles:
  card:
    - background-color: '#333'
    - border-radius: 20px
  name:
    - font-weight: bold
    - font-size: 34px
    - justify-self: center
    - letter-spacing: '-2.0px'
    - color: var(--secondary-text-color)
  grid:
    - grid-template-areas: |-
        " . logo watt watt watt  "  " . n n n n  " 
        " . graph graph graph graph "  " . lista setting  push media  "  
    - grid-template-columns: 10px repeat(4, 1fr)
    - grid-template-rows: 0fr 0.2fr
    - grid-column-gap: 0.1em
custom_fields:
  watt:
    card:
      type: custom:button-card
      name: |
        [[[
            return 'Instantaneo '+ states['sensor.generale_casa_energy'].state + 'W';
        ]]]
      styles:
        card:
          - background-color: transparent
          - border-style: none
        name:
          - align-self: middle
          - justify-self: left
          - font-size: 15px
          - font-color: '#b4c3cd'
  logo:
    card:
      type: custom:button-card
      color: transparent
      icon: |
        [[[ 
         if (states['automation.power_control'].state == 'on') return "mdi:head-flash"; 
         else return "mdi:hand-back-right-off"; 
        ]]]
      styles:
        card:
          - background-color: transparent
          - border-style: none
        icon:
          - color: |
              [[[ 
                 if (states['automation.power_control'].state == 'on') return "white   "; 
                 else return "#252525"; 
               ]]] 
          - margin-left: 30px
          - align-self: start
          - text-align: start
          - border-radius: 30%
          - background-color: |
              [[[ 
                 if (states['automation.power_control'].state == 'on') return "OliveDrab   "; 
                 else return "#606060"; 
               ]]] 
      tap_action:
        action: call-service
        service: automation.toggle
        service_data:
          entity_id: automation.power_control
  graph:
    card:
      type: custom:apexcharts-card
      graph_span: 3h
      header:
        show: true
        show_states: false
        colorize_states: true
      series:
        - entity: sensor.shelly_em_assorbimento_casa
          stroke_width: 2
          show:
            extremas: true
      card_mod:
        style: |
          ha-card { 
            border: 100px; 
            background: none; 
            width: 95%; 
            height: 300px; 
            padding-left: 10px 
            } 
  lista:
    card:
      type: custom:button-card
      icon: mdi:view-list-outline
      show_icon: true
      styles:
        card:
          - background-color: '#4B5975'
          - border-radius: 18px
          - border-style: none
          - box-shadow: 0px 5px 10px 0px rgba(0, 0, 0, 0.2)
          - height: 50px
          - width: 70px
        icon:
          - width: 30px
          - height: 30px
          - color: white
          - align-self: center
      tap_action:
        action: fire-dom-event
        browser_mod:
          service: browser_mod.popup
          data:
            card_mod:
              style: |

                :host { 
                  --ha-card-background: rgba(50,65,85,1); 
                  --mdc-dialog-scrim-color: rgba(15,15,15,0.9); 
                  } 
            content:
              type: vertical-stack
              cards:
                - type: custom:mushroom-template-card
                  primary: Lista carichi
                  style: |
                    ha-card { 
                      border: 100px; 
                      background: none; 
                      } 
                - type: custom:mushroom-template-card
                  style: |
                    :host { 
                      --ha-card-background: rgba(50,65,85,1); 
                      } 
                  secondary: |
                    {% from 'power_control.jinja' import entities_control %}  
                    {% for entities in entities_control().split() %} 
                    {{ states[entities].name -}}   {% endfor %} 
                  multiline_secondary: true
                  fill_container: true
                  tap_action:
                    action: none
                  hold_action:
                    action: none
                  double_tap_action:
                    action: none
                - type: vertical-stack
                  cards:
                    - type: custom:mushroom-template-card
                      primary: Esclusi dal ripristino
                      style: |
                        ha-card { 
                          border: 100px; 
                          background: none; 
                          } 
                    - type: conditional
                      conditions:
                        - entity: sensor.dispositivi_esclusi_dal_ripristino_carico
                          state_not: RESET
                      card:
                        type: custom:mushroom-template-card
                        style: |
                          :host { 
                            --ha-card-background: rgba(50,65,85,1); 
                            } 
                        secondary: >-
                          {% for t in
                          state_attr('sensor.dispositivi_esclusi_dal_ripristino_carico',
                          'list_exclude') %}
                            {{ states[t].name -}}
                          {% endfor %}
                        multiline_secondary: true
                        fill_container: true
                        tap_action:
                          action: none
                        hold_action:
                          action: none
                        double_tap_action:
                          action: none
  setting:
    card:
      type: custom:button-card
      color: transparent
      show_name: false
      name: Power
      icon: mdi:cog
      styles:
        card:
          - background-color: '#4B5975'
          - border-radius: 18px
          - border-style: none
          - box-shadow: 0px 5px 10px 0px rgba(0, 0, 0, 0.2)
          - width: 70px
          - aspect-ratio: 1/0.7
        icon:
          - color: white
          - align-self: center
      tap_action:
        action: fire-dom-event
        browser_mod:
          service: browser_mod.popup
          data:
            card_mod:
              style: |
                :host { 
                  --ha-card-background: rgba(50,65,85,1); 
                  --mdc-dialog-scrim-color: rgba(15,15,15,0.9); 
                  } 
            content:
              type: vertical-stack
              cards:
                - type: custom:layout-card
                  layout_type: grid-layout
                  layout:
                    grid-template-columns: repeat(2, 1fr)
                    grid-column-gap: 0.3em
                    grid-row-gap: 0.3em
                  cards:
                    - type: custom:mushroom-title-card
                      title: Tempi
                    - type: custom:mushroom-title-card
                      title: Soglie
                    - type: custom:mushroom-number-card
                      entity: input_number.ritardo_distacco_carico
                      layout: vertical
                      icon_color: green
                      tap_action:
                        action: none
                      hold_action:
                        action: none
                      double_tap_action:
                        action: none
                      card_mod:
                        style: |
                          :host { 
                            --ha-card-background: rgba(50,65,85,1); 
                            --mdc-dialog-scrim-color: rgba(15,15,15,0.9); 
                            } 
                    - type: custom:mushroom-number-card
                      entity: input_number.distacco_carico
                      layout: vertical
                      card_mod:
                        style: |
                          :host { 
                            --ha-card-background: rgba(50,65,85,1); 
                            --mdc-dialog-scrim-color: rgba(15,15,15,0.9); 
                            } 
                    - type: custom:mushroom-number-card
                      entity: input_number.ritardo_ripristino_carico
                      layout: vertical
                      icon_color: red
                      tap_action:
                        action: none
                      hold_action:
                        action: none
                      double_tap_action:
                        action: none
                      card_mod:
                        style: |
                          :host { 
                            --ha-card-background: rgba(50,65,85,1); 
                            --mdc-dialog-scrim-color: rgba(15,15,15,0.9); 
                            } 
                    - type: custom:mushroom-number-card
                      entity: input_number.distacco_urgente
                      layout: vertical
                      tap_action:
                        action: none
                      hold_action:
                        action: none
                      double_tap_action:
                        action: none
                      card_mod:
                        style: |
                          :host { 
                            --ha-card-background: rgba(50,65,85,1); 
                            --mdc-dialog-scrim-color: rgba(15,15,15,0.9); 
                            } 
                - type: custom:mushroom-select-card
                  entity: select.escludi_dispositivi_dal_ripristino_carico
                  fill_container: true
                  icon_type: none
                  secondary_info: none
                  style: |
                    ha-card { 
                      border: 100px; 
                      background: none; 
                      } 
  push:
    card:
      type: custom:button-card
      color: transparent
      show_name: false
      name: Power
      icon: |
        [[[ 
         if (states['automation.notify_control_power_push'].state == 'on') return "mdi:cellphone-check"; 
         else return "mdi:cellphone-off"; 
        ]]] 
      styles:
        card:
          - background-color: '#4B5975'
          - border-radius: 18px
          - border-style: none
          - box-shadow: 0px 5px 10px 0px rgba(0, 0, 0, 0.2)
          - width: 70px
          - aspect-ratio: 1/0.7
        icon:
          - align-self: center
          - color: |
              [[[ 
                 if (states['automation.notify_control_power_push'].state == 'on') return "white   "; 
                 else return "#252530"; 
               ]]]
      tap_action:
        action: call-service
        service: automation.toggle
        service_data:
          entity_id: automation.notify_control_power_push
  media:
    card:
      type: custom:button-card
      color: transparent
      show_name: false
      name: Power
      icon: |
        [[[ 
         if (states['automation.notify_control_power_media_player'].state == 'on') return "mdi:account-voice"; 
         else return "mdi:speaker-off"; 
        ]]] 
      styles:
        card:
          - background-color: '#4B5975'
          - border-radius: 18px
          - border-style: none
          - box-shadow: 0px 5px 10px 0px rgba(0, 0, 0, 0.2)
          - width: 70px
          - aspect-ratio: 1/0.7
        icon:
          - align-self: center
          - color: |
              [[[ 
                 if (states['automation.notify_control_power_media_player'].state == 'on') return "white   "; 
                 else return "#252530"; 
               ]]] 
      tap_action:
        action: call-service
        service: automation.toggle
        service_data:
          entity_id: automation.notify_control_power_media_player
