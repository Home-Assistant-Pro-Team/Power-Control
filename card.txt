type: custom:button-card
name: Power Control
show_icon: false
aspect_ratio: 1/1
styles:
  card:
    - background-color: '#333'
    - border-radius: 20px
    - padding: 8px
  name:
    - font-weight: bold
    - font-size: 34px
    - align-self: middle
    - justify-self: center
    - padding-top: 7px
    - padding-bottom: 13px
    - padding-left: 10px
    - letter-spacing: '-2.0px'
    - color: var(--secondary-text-color)
    - display: |
        [[[
          if (states['switch.abat_jour'].state == 'on')
            return "block";
          return "none";
        ]]]
  grid:
    - grid-template-areas: >-
        "n n n n n" "graph graph graph graph graph" "lista setting i3 push
        media" 
    - grid-template-columns: 0.2fr 0.2fr 0.2fr 0.2fr 0.2fr
    - grid-template-rows: min-content min-content min-content min-content
  custom_fields:
    watt:
      - position: absolute
      - left: 33%
      - top: 12%
    logo:
      - position: absolute
      - left: 10%
      - top: 4%
custom_fields:
  watt:
    card:
      type: custom:button-card
      name: |
        [[[
            return 'Instantaneo '+ states['sensor.shellyem_b168e7_channel_1_power'].state + 'W';
        ]]]
      styles:
        card:
          - background-color: transparent
          - border-style: none
        name:
          - align-self: middle
          - justify-self: center
          - padding-left: 10px
          - font-size: 15px
          - font-weight: 400
          - font-color: '#b4c3cd'
  logo:
    card:
      type: custom:button-card
      color: transparent
      show_name: false
      name: false
      icon: |
        [[[
         if (states['automation.power_control'].state == 'on') return "mdi:head-flash";
         else return "mdi:hand-back-right-off";
        ]]]
      show_entity_picture: false
      styles:
        card:
          - background-color: transparent
          - border-style: none
        icon:
          - width: 45px
          - height: 45px
          - color: |
              [[[
                 if (states['automation.power_control'].state == 'on') return "white   ";
                 else return "#252525";
               ]]]
          - padding: 6px
          - margin-left: 30px
          - align-self: start
          - text-align: start
          - border-radius: 30%
          - background-color: |
              [[[
                 if (states['automation.power_control'].state == 'on') return "OliveDrab   ";
                 else return "#606060";
               ]]]
      tap_action:
        action: call-service
        service: automation.toggle
        service_data:
          entity_id: automation.power_control
  graph:
    card:
      type: custom:apexcharts-card
      graph_span: 3h
      header:
        show: true
        show_states: false
        colorize_states: true
      series:
        - entity: sensor.shellyem_b168e7_channel_1_power
          stroke_width: 2
          show:
            extremas: true
      card_mod:
        style: |
          ha-card {
            border: 100px;
            background: none;
            width: 95%;
            height: 300px;
            padding-left: 10px
            }
  lista:
    card:
      type: custom:button-card
      icon: mdi:view-list-outline
      show_state: false
      show_icon: true
      show_name: false
      styles:
        card:
          - background-color: '#4B5975'
          - border-radius: 18px
          - border-style: none
          - box-shadow: 0px 5px 10px 0px rgba(0, 0, 0, 0.2)
          - height: 50px
          - width: 70px
        icon:
          - width: 30px
          - height: 30px
          - color: white
          - align-self: start
          - text-align: start
          - padding: 8px
        img_cell:
          - justify-content: middle
          - align-self: middle
          - margin: none
      tap_action:
        action: fire-dom-event
        browser_mod:
          service: browser_mod.popup
          data:
            card_mod:
              style: |
                ha-dialog {
                  --mdc-dialog-min-width: 400px !important;
                  --mdc-dialog-max-width: 600px !important;
                  }
                :host {
                  --ha-card-background: rgba(50,65,85,1);
                  --mdc-dialog-scrim-color: rgba(15,15,15,0.9);
                  }
            content:
              type: vertical-stack
              cards:
                - type: markdown
                  content: |-
                    **Lista carichi**
                    {% from 'power_control.jinja' import entities_control %}
                      {% for entities in entities_control().split() %}
                        {{ states[entities].name -}}
                      {% endfor %}
                    **Esclusi dal ripristino**
                      {% for t in state_attr('sensor.dispositivi_esclusi_dal_ripristino_carico', 'list_exclude') %}
                        {{ states[t].name -}}
                      {% endfor %}
  setting:
    card:
      type: custom:button-card
      color: transparent
      show_name: false
      name: Power
      icon: mdi:cog
      styles:
        card:
          - background-color: '#4B5975'
          - border-radius: 18px
          - border-style: none
          - box-shadow: 0px 5px 10px 0px rgba(0, 0, 0, 0.2)
          - height: 50px
          - width: 70px
        icon:
          - width: 30px
          - height: 30px
          - color: white
          - align-self: start
          - text-align: start
          - padding: 8px
        img_cell:
          - justify-content: middle
          - align-self: middle
          - margin: none
      tap_action:
        action: fire-dom-event
        browser_mod:
          service: browser_mod.popup
          data:
            card_mod:
              style: |
                ha-dialog {
                  --mdc-dialog-min-width: 500px !important;
                  --mdc-dialog-max-width: 600px !important;
                  --mdc-dialog-min-height: 520px;
                  }
                :host {
                  --ha-card-background: rgba(50,65,85,1);
                  --mdc-dialog-scrim-color: rgba(15,15,15,0.9);
                  }
            content:
              type: vertical-stack
              cards:
                - type: horizontal-stack
                  cards:
                    - type: vertical-stack
                      title: Tempi
                      cards:
                        - type: tile
                          entity: input_number.ritardo_distacco_carico
                          vertical: true
                          icon: mdi:clock-alert
                          color: deep-orange
                        - type: tile
                          entity: input_number.ritardo_ripristino_carico
                          vertical: true
                          icon: mdi:clock-check
                          color: green
                    - type: vertical-stack
                      title: Soglie
                      cards:
                        - type: tile
                          entity: input_number.distacco_carico
                          vertical: true
                        - type: tile
                          entity: input_number.distacco_urgente
                          vertical: true
                - type: horizontal-stack
                  title: Entit√† escluse dal ripristino
                  cards:
                    - type: tile
                      entity: select.escludi_dispositivi_dal_ripristino_carico
  i3:
    card:
      type: custom:button-card
      color: transparent
      show_name: false
      name: Power
      icon: mdi:signal-off
      styles:
        card:
          - background-color: '#4B5975'
          - border-radius: 18px
          - border-style: none
          - box-shadow: 0px 5px 10px 0px rgba(0, 0, 0, 0.2)
          - height: 50px
          - width: 70px
        icon:
          - width: 30px
          - height: 30px
          - color: white
          - align-self: start
          - text-align: start
          - padding: 8px
        img_cell:
          - justify-content: middle
          - align-self: middle
          - margin: none
  push:
    card:
      type: custom:button-card
      color: transparent
      show_name: false
      name: Power
      icon: |
        [[[
         if (states['automation.notify_control_power_push'].state == 'on') return "mdi:cellphone-check";
         else return "mdi:cellphone-off";
        ]]]
      styles:
        card:
          - background-color: '#4B5975'
          - border-radius: 18px
          - border-style: none
          - box-shadow: 0px 5px 10px 0px rgba(0, 0, 0, 0.2)
          - height: 50px
          - width: 70px
        icon:
          - width: 30px
          - height: 30px
          - align-self: start
          - text-align: start
          - padding: 8px
          - color: |
              [[[
                 if (states['automation.notify_control_power_push'].state == 'on') return "white   ";
                 else return "#252530";
               ]]]
        img_cell:
          - justify-content: middle
          - align-self: middle
          - margin: none
      tap_action:
        action: call-service
        service: automation.toggle
        service_data:
          entity_id: automation.notify_control_power_push
  media:
    card:
      type: custom:button-card
      color: transparent
      show_name: false
      name: Power
      icon: |
        [[[
         if (states['automation.notify_control_power_media_player'].state == 'on') return "mdi:account-voice";
         else return "mdi:speaker-off";
        ]]]
      styles:
        card:
          - background-color: '#4B5975'
          - border-radius: 18px
          - border-style: none
          - box-shadow: 0px 5px 10px 0px rgba(0, 0, 0, 0.2)
          - height: 50px
          - width: 70px
        icon:
          - width: 30px
          - height: 30px
          - align-self: start
          - text-align: start
          - padding: 8px
          - color: |
              [[[
                 if (states['automation.notify_control_power_media_player'].state == 'on') return "white   ";
                 else return "#252530";
               ]]]
        img_cell:
          - justify-content: middle
          - align-self: middle
          - margin: none
      tap_action:
        action: call-service
        service: automation.toggle
        service_data:
          entity_id: automation.notify_control_power_media_player
